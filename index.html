<html lang="en"><head>
    <link rel="stylesheet" href="https://www.webrtc-experiment.com/style.css">

    <style>
        li {
            border-bottom: 0px solid rgb(189, 189, 189);
            border-left: 0px solid rgb(189, 189, 189);
            padding: .5em;
        }
        label {
            display: inline-block;
            width: 8em;
        }

.center {
  display: flex;
  justify-content: center;
  align-items: center;
  height: auto;
  font-size: 15px;
            line-height: 2;

}

        h1 span {
            background: yellow;
            border: 2px solid #8e1515;
            padding: 2px 8px;
            margin: 2px 5px;
            border-radius: 7px;
            color: #8e1515;
            display: inline-block;
        }

        .recordrtc button {
            font-size: inherit;
        }

        .recordrtc button, .recordrtc select {
            vertical-align: middle;
            line-height: 1;
            padding: 2px 5px;
            height: auto;
            font-size: 12px;
            margin: 0;
        }

        .recordrtc, .recordrtc .header {
            display: block;
            text-align: center;
            padding-top: 0;
        }

        .recordrtc video, .recordrtc img {
            max-width: 100%!important;
            vertical-align: top;
        }

        .recordrtc audio {
            vertical-align: bottom;
        }

        .recordrtc option[disabled] {
            display: none;
        }

        .recordrtc select {
            font-size: 17px;
        }

	.buttons {
  background-color: red; /* Green */
  border: none;
  color: white;
  padding: 10px 20px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 16px;
  margin: 4px 2px;
  cursor: pointer;
border-radius: 8px;
}

	.buttons3 {
  background-color: red; /* Green */
  border: none;
  color: white;
  padding: 10px 20px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 16px;
  margin: 4px 2px;
  cursor: pointer;
border-radius: 8px;
}

.buttons3:disabled{
background-color:white;
color:white;
border: none;
}

    </style>

<br>

<body aria-hidden="false" style="padding: 0px;">
    <article style="height: auto !important;">
        <header style="text-align: center;">
            <h1>
                Welcome to the Participant Portal for <a href="https://britobabylab.com/orca-study/">The ORCA Project</a>
            </h1>
        </header>
	<div>
		<img src="https://britobabylab.com/wp-content/uploads/2023/09/Screen-Shot-2023-09-28-at-1.04.28-PM.png" alt="ORCA Project Logo"
		style="max-width: 80%; display: block; margin-left: auto; margin-right:auto;">
	</div>

        <section >
            <div class="center">
                Before starting, let's turn on your camera and make sure we can see your baby:
<br>
            </div>

            <div class="center">


                <button class="buttons" id="btn-start-recording">Start video</button>
                <button class="buttons" id="btn-pause" disabled>Pause</button>

                <button class="buttons" id="btn-stop-recording" disabled>Stop video</button>

<br>
            </div>

	    <div class = "center">
		<video id="webvid" style="width: 70%;" controls autoplay playsinline></video>
		<br>
	    </div>

<div class="center">

<button class="buttons" id="play" disabled>When you're ready, click here to begin!</button>

<hr style="border-top: 0;border-bottom: 0px solid rgb(189, 189, 189);margin: 4px 4px;margin-top: 1px;">
</div>

	    <br>
            <div class="center">
                Try to make sure that only your baby's face is in the video, like this: 
            </div>



<div class="center">
<video poster="demo.png" id="myvideo" style="width: 60%;"> <source src='Cecile.mp4'></video>
</div>
<br>




            <div class="center">
<br>
                <button class="buttons" id="btn-save-recording"disabled>Save video</button>
   
            </div>
<br>
	</section>





<hr>

<script src="https://www.WebRTC-Experiment.com/RecordRTC.js"></script>
<script>
var video = document.querySelector('video');
var mimeType = 'video/webm';
var fileExtension = 'webm';




function captureCamera(callback) {
    navigator.mediaDevices.getUserMedia({ audio: true, video: true }).then(function(camera) {
        callback(camera);
    }).catch(function(error) {
        alert('Unable to capture your camera. Please check console logs.');
        console.error(error);
    });
}
var blob;

function stopRecordingCallback() {

    video.src = video.srcObject = null;
    video.muted = false;
    video.volume = 1;
    video.src = URL.createObjectURL(recorder.getBlob());
    blob = recorder.getBlob();
    
    recorder.camera.stop();
    recorder.destroy();
    recorder = null;

    document.getElementById('btn-save-recording').disabled = false;
    document.getElementById('btn-start-recording').disabled = false;
}

var recorder; // globally accessible
var started = 0;

document.getElementById('btn-start-recording').onclick = function() {
    this.disabled = true;
    document.getElementById('btn-save-recording').disabled = true;
document.getElementById('btn-pause').disabled = false;
    document.getElementById('btn-stop-recording').disabled = false;

	if (pause===1) {
		pause = 0;
		document.querySelector("#webvid").play();
		if (started==1) {
			document.querySelector("#myvideo").play();
			var elem = document.getElementById("myvideo"); 
	    		openFullscreen(elem);
		}
		
	}

	else {

    captureCamera(function(camera) {
        video.muted = true;
        video.volume = 0;
        video.srcObject = camera;

        recorder = RecordRTC(camera, {
            type: 'video'
        });

        recorder.startRecording();

        // release camera on stopRecording
        recorder.camera = camera;


	document.getElementById('play').disabled = false;
    });
  }

};


    
function openFullscreen(elem) {
  			if (elem.requestFullscreen) {
    				elem.requestFullscreen();
  			} else if (elem.webkitRequestFullscreen) { /* Safari */
    				elem.webkitRequestFullscreen();
  			} else if (elem.msRequestFullscreen) { /* IE11 */
    				elem.msRequestFullscreen();
  			}		
			
};

document.querySelector("#play").addEventListener("click", () => {
	    document.querySelector("#myvideo").play();
	    started = 1;
	    var elem = document.getElementById("myvideo"); 
			
	    openFullscreen(elem);
	
	    		/* When the openFullscreen() function is executed, open the video in fullscreen.
            		Note that we must include prefixes for different browsers, as they don't support the requestFullscreen method yet */
});


document.getElementById('btn-stop-recording').onclick = function() {
    this.disabled = true;
    document.getElementById('btn-save-recording').disabled = false;
    document.getElementById('btn-start-recording').disabled = false;
    document.getElementById('btn-pause').disabled = true;


document.querySelector("#myvideo").pause();

document.getElementById('play').disabled = true;

    recorder.stopRecording(stopRecordingCallback);
};

document.getElementById('btn-save-recording').onclick = function() {
    

   invokeSaveAsDialog(blob, 'test2.mp4');
 

};
var pause = 0;

document.getElementById('btn-pause').onclick = function() {
    this.disabled = true;
    document.getElementById('btn-stop-recording').disabled = false;
    document.getElementById('btn-start-recording').disabled = false;
document.querySelector("#myvideo").pause();
document.querySelector("#webvid").pause();
pause = 1;
};


</script>

<footer style="margin-top: 20px;"><small id="send-message"></small></footer>
<script src="https://www.webrtc-experiment.com/common.js"></script>
