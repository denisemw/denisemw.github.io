<html lang="en"><head>
    <link rel="stylesheet" href="https://www.webrtc-experiment.com/style.css">

    <style>
        li {
            border-bottom: 1px solid rgb(189, 189, 189);
            border-left: 1px solid rgb(189, 189, 189);
            padding: .5em;
        }
        label {
            display: inline-block;
            width: 8em;
        }


        h1 span {
            background: yellow;
            border: 2px solid #8e1515;
            padding: 2px 8px;
            margin: 2px 5px;
            border-radius: 7px;
            color: #8e1515;
            display: inline-block;
        }

        .recordrtc button {
            font-size: inherit;
        }

        .recordrtc button, .recordrtc select {
            vertical-align: middle;
            line-height: 1;
            padding: 2px 5px;
            height: auto;
            font-size: inherit;
            margin: 0;
        }

        .recordrtc, .recordrtc .header {
            display: block;
            text-align: center;
            padding-top: 0;
        }

        .recordrtc video, .recordrtc img {
            max-width: 100%!important;
            vertical-align: top;
        }

        .recordrtc audio {
            vertical-align: bottom;
        }

        .recordrtc option[disabled] {
            display: none;
        }

        .recordrtc select {
            font-size: 17px;
        }
    </style>

<br>

<body aria-hidden="false" style="padding: 0px;">
    <article style="height: auto !important;">
        <header style="text-align: center;">
            <h1>
                Welcome to the Participant Portal for <a href="https://britobabylab.com/orca-study/">The ORCA Project</a>
            </h1>
        </header>
	<div>
		<img src="https://britobabylab.com/wp-content/uploads/2023/09/Screen-Shot-2023-09-28-at-1.04.28-PM.png" alt="ORCA Project Logo"
		style="max-width: 80%; display: block; margin-left: auto; margin-right:auto;">
	</div>

        <section class="experiment recordrtc">


	    <div>
		<video style="width: 96%; height: 54%;" controls autoplay playsinline></video>
		<br>
	    </div>

            <div>
		<h3 class="header" style="margin: 0;">

                <button id="btn-start-recording">Start Camera</button>
                <button id="btn-stop-recording" disabled>Stop Camera</button>

		<hr style="border-top: 0;border-bottom: 1px solid rgb(189, 189, 189);margin: 4px -12px;margin-top: 8px;">

            </h3>
            </div>

	    <br>

	<br>
<h2 class="header" style="margin: 0;">

<button id="play" disabled>Please click here to begin the study!</button>

<hr style="border-top: 0;border-bottom: 1px solid rgb(189, 189, 189);margin: 4px -12px;margin-top: 8px;">

            </h2>

<br>
<br>
<video id="myvideo" style="width: 0%;"> <source src='Cecile.mp4'></video>
<br>
<br>
            <div style="text-align: center; display: block;">
                <button style="width: 33%; " id="btn-save-recording"disabled>Download Study Video</button>
   
            </div>

<br><br>




<hr>

<script src="https://www.WebRTC-Experiment.com/RecordRTC.js"></script>
<script>
var video = document.querySelector('video');
var mimeType = 'video/webm';
var fileExtension = 'webm';




function captureCamera(callback) {
    navigator.mediaDevices.getUserMedia({ audio: true, video: true }).then(function(camera) {
        callback(camera);
    }).catch(function(error) {
        alert('Unable to capture your camera. Please check console logs.');
        console.error(error);
    });
}
var blob;

function stopRecordingCallback() {

    video.src = video.srcObject = null;
    video.muted = false;
    video.volume = 1;
    video.src = URL.createObjectURL(recorder.getBlob());
    blob = recorder.getBlob();
    
    recorder.camera.stop();
    recorder.destroy();
    recorder = null;

    document.getElementById('btn-save-recording').disabled = false;
}

var recorder; // globally accessible

document.getElementById('btn-start-recording').onclick = function() {
    this.disabled = true;

    captureCamera(function(camera) {
        video.muted = true;
        video.volume = 0;
        video.srcObject = camera;

        recorder = RecordRTC(camera, {
            type: 'video'
        });

        recorder.startRecording();

        // release camera on stopRecording
        recorder.camera = camera;


	document.getElementById('play').disabled = false;
    });

};
    
function openFullscreen(elem) {
  			if (elem.requestFullscreen) {
    				elem.requestFullscreen();
  			} else if (elem.webkitRequestFullscreen) { /* Safari */
    				elem.webkitRequestFullscreen();
  			} else if (elem.msRequestFullscreen) { /* IE11 */
    				elem.msRequestFullscreen();
  			}			
			
			
	    	}

document.querySelector("#play").addEventListener("click", () => {
        document.getElementById('btn-stop-recording').disabled = false;
	    		document.querySelector("#myvideo").play();
	    		var elem = document.getElementById("myvideo"); 
	    		openFullscreen(elem);
		
	    		/* When the openFullscreen() function is executed, open the video in fullscreen.
            		Note that we must include prefixes for different browsers, as they don't support the requestFullscreen method yet */
	   	});


document.getElementById('btn-stop-recording').onclick = function() {
    this.disabled = true;
    document.getElementById('btn-save-recording').disabled = false;
document.getElementById('play').disabled = true;

    recorder.stopRecording(stopRecordingCallback);
};

document.getElementById('btn-save-recording').onclick = function() {
    

   invokeSaveAsDialog(blob, 'test2.webm');
 

};




</script>

<footer style="margin-top: 20px;"><small id="send-message"></small></footer>
<script src="https://www.webrtc-experiment.com/common.js"></script>
